name: Auto Rebase All PRs

on:
  schedule:
    - cron: '0 * * * *' # Runs every hour

jobs:
  rebase:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Fetch PRs
        run: |
          gh pr list --state open --json number --jq '.[].number' > pr_numbers.txt

      - name: Rebase PRs
        run: |
          while read number; do
            gh pr checkout $number
            git rebase main
            git push origin HEAD:refs/pull/$number/merge --force
          done < pr_numbers.txt
